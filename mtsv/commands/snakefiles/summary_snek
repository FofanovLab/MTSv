from mtsv.utils import (script_path, get_item_from_artifact)


SUMMARY_SCRIPT = script_path('summary.py')
TAXDUMP = get_item_from_artifact(config['database_config'], "taxdump-path")

rule summary:
    """
    Summarize query hits.
    """
    input: "binning/{sample}_merged.clp"
    output:
        summary = report(
            "results/{sample}_raw_summary.csv",
            caption="report/raw_summary.rst",
            category="2 Summary")
    params:
        max_taxa_per_query = config.get("max_taxa_per_query", 200),
        taxdump = TAXDUMP,
        chunksize = 100000
    threads: 1
    log: "logs/summary_{sample}.log"
    message:
        """
        Parsing merged binning file {input}.
        Writing to summary file: {output}.
        Logging to {log}.
        Using {threads} threads.
        """
    script: SUMMARY_SCRIPT
